{% extends "layout.html" %}

{% block body %}
<br>
<h2 class="gl_h1">User {{ profile_user.username }}</h2>

<!-- hidden form to create or edit the bio -->
{% if request.user == profile_user %}
<form id="bio" method="post" style="display: none;" class="formm">
    {% csrf_token %}
    <input name="bioo" placeholder="your bio.." value="{{ profile.bio }}">
    <button type="submit">Save</button>
</form>
{% endif %}

<!-- profile info card -->
<div class="card text-white bg-dark mb-3" style="max-width: 18rem;">
  <div class="card-header">User information</div>
  <div class="card-body">
    {% if profile.bio %}
    <h5 class="card-title" style="color: rgb(134, 201, 182);">Bio: {{ profile.bio }}</h5>
    {% endif %}
    <small><p class="card-text">Joined in: {{ profile.create_time }}</p></small>
  </div>
</div>

<!-- bio buttons -->
{% if request.user == profile_user %}
  {% if profile.bio %}
    <button id="edit-bio" class="case_btn" style="width: 120px;">Edit bio</button> <br>
  {% else %}
    <p>No bio, you can add one</p>
    <button id="add-bio" class="case_btn" style="width: 120px;">Add bio</button> <br>
  {% endif %}
{% endif %}
<br>
<!-- CASES BUTTON -->
<h3 class="gl_h1 text-center">Check out your cases</h3>
{% if cases %}
<button class="case_btn" data-bs-toggle="modal" data-bs-target="#casesModal">View Cases ({{ cases.count }})</button><br>
{% else %}
<p class="text-center">You have no cases</p>
{% endif %}
<br>
<!-- POSTS BUTTON -->
<h3 class="gl_h1 text-center">Check out your Posts</h3>
{% if posts %}
<button class="case_btn" data-bs-toggle="modal" data-bs-target="#postsModal">View Posts ({{ posts.count }})</button>
{% else %}
<p class="text-center">No posts yet</p>
{% endif %}


<!-- CASES MODAL -->
<div class="modal fade" id="casesModal" tabindex="-1" aria-labelledby="casesModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title" id="casesModalLabel">Cases of {{ profile_user.username }}</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {% for case in cases %}
        <div class="card text-white bg-secondary mb-3">
          <div class="card-body">
            <h5 class="card-title"><a href="{% url 'case_detail' case.id %}" class="text-success">{{ case.title }}</a></h5>
            {% if case.is_public %}
              <p class="card-text"><span style="color: #39ff14;">Public</span></p>
            {% else %}
              <p class="card-text"><span style="color:#ff1414">Private</span></p>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<!-- POSTS MODAL -->
<div class="modal fade" id="postsModal" tabindex="-1" aria-labelledby="postsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title" id="postsModalLabel">Posts by {{ profile_user.username }}</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row g-4">
          {% for post in posts %}
          <div class="col-md-4">
            <div class="card h-100" style="background-color:#212020; color:#ddeadb;">
              {% if post.images.exists %}
                <img src="{{ post.images.first.image.url }}" class="card-img-top" alt="Post image">
              {% endif %}
              <div class="card-body">
                <h5 class="card-title">{{ post.title }}</h5>
                <p class="card-text text-truncate" style="max-height:3em;">{{ post.body }}</p>
              </div>
              <div class="card-footer">
                <small class="text-muted">By <a href="{% url 'profile' post.author.username %}">{{ post.author.username }}</a> in <a href="{% url 'country' post.country %}">{{ post.country }}</a></small>
                <br>
                <a href="{% url 'view_post' post.id %}" class="btn btn-outline-success btn-sm mt-2">Read More</a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bio toggle script -->
<script>
const add = document.getElementById('add-bio');
const edit = document.getElementById('edit-bio');
const form = document.getElementById('bio');

if (add) add.onclick = () => {
    form.style.display = 'block';
    add.style.display = 'none';
}
if (edit) edit.onclick = () => {
    form.style.display = 'block';
    edit.style.display = 'none';
}
</script>
{% endblock %}
